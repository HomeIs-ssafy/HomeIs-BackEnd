<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.homeis.map.model.mapper.MapMapper">
    <update id="increaseView" parameterType="string">
    	update houseinfo set view = view + 1
    	where aptCode = #{aptCode};
    </update>
    
    <select id="getApartDealInfo" parameterType="string" resultType="apartDealInfo">
        select info.aptCode, info.buildYear, info.roadName, info.roadNameCode, info.dong, info.sigunguCode, info.eubmyundongCode,
        info.dongCode, info.apartmentName, info.jibun, info.lng, info.lat, info.view, info.total_like, deal.dealAmount, deal.dealYear, deal.dealMonth,
        deal.dealDay, deal.area, deal.floor, deal.cancelDealType
        from houseinfo info join housedeal deal
        on info.aptCode = deal.aptCode
        where info.aptCode = #{aptCode}
        order by deal.dealYear, deal.dealMonth, deal.dealDay
    </select>
    
    <select id="selectReviewAll" parameterType="string" resultType="review">
        select id, user_id, aptCode, content, create_time, score
        from home_review
        where aptCode = #{aptCode};
    </select>
	
	<insert id="insertLike" parameterType="houseLike">
		insert into house_like (aptCode, user_id)
		values(#{aptCode}, #{userId});
	</insert>
	
	<update id="increaseLike" parameterType="string">
    	update houseinfo set total_like = total_like + 1
    	where aptCode = #{aptCode};
    </update>
    
    <delete id="deleteLike" parameterType="map">
    	delete from house_like
    	where aptCode = #{aptCode}
    	and user_id = #{userId};
    </delete>
    
    <update id="decreaseLike" parameterType="string">
    	update houseinfo set total_like = total_like - 1
    	where aptCode = #{aptCode};
    </update>
    
    <insert id="insertReview" parameterType="review">
    	insert into home_review(user_id, aptCode, content, create_time, score)
    	values(#{userId}, #{aptCode}, #{content}, now(), #{score});
    </insert>
    
    <delete id="deleteReview" parameterType="map">
    	delete from home_review
    	where id = #{id}
    	and user_id = #{userId};
    </delete>
</mapper>